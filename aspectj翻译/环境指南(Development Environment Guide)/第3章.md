## 第3章AspectJ浏览器 ##

### 简介 ###

AJBrowser提供了一个用于编译ajc程序和导航横切结构的GUI。

AspectJ浏览器可以编辑程序源文件，使用AspectJ编译器`ajc`进行编译并运行程序，并以图形方式导航程序的横切结构。 有关`ajc`的更多信息，请参阅`ajc`命令行参考。

从命令行启动浏览器，方法是输入`ajbrowser`以调用{aspectj}/bin中的脚本（如果AspectJ安装正确）或直接使用aspectjtools.jar，并指定任何参数或一些构建配置文件(后缀 .lst)：


	java -jar aspectj1.1/lib/aspectjtools.jar aspectj1.1/doc/examples/spacewar/debug.lst 

----

### 构建程序 ###

#### 构建配置 ####

构建配置是为程序编译的一组文件（以及可选的其他编译参数）。由于`ajc`需要指定所有源（至少使用`-sourceroots`选项），因此大多数用户都会创建列出要编译的文件的`.lst`文件（每行一个参数，允许使用globbing -）有关更多详细信息，请参阅ajc命令行参考）。

要使用特定程序，请使用`File`菜单，"`open`"项目或使用`"Open Build Configuration"`按钮（![](file:///C:/Users/laihj/Desktop/myTool/about-aspectj/aspectj/aspecjt1.8/doc/devguide/openConfig.gif))。从GUI中选择相应的"`.lst`"构建配置文件。您可以通过传递任意数量的"`.lst`"路径来从命令行填充构建列表。 （但是，如果你传入任何非"`.lst`"参数，它将直接运行命令行编译器。）

要在构建配置之间切换，请使用相应的工具栏按钮选择，添加或删除它们。

全局构建选项存储在`HOME`目录中的`.ajbrowser`文件中。通过单击"`Options`"按钮或选择工具菜单项"`Options`..."在GUI中编辑它们。这是如何设置`classpath`，`aspectpath`等

以下部分介绍构建。

#### 编译程序构建配置 ####

要编译，请点击"`Build`"按钮（![](file:///C:/Users/laihj/Desktop/myTool/about-aspectj/aspectj/aspecjt1.8/doc/devguide/build.gif)），或者使用`tools`菜单。

您可以从GUI中的不同构建配置中进行选择（请参阅下图中的标签1）。 （如果您遇到类路径或其他错误，请按上述方式设置全局构建选项。）

![](file:///C:/Users/laihj/Desktop/myTool/about-aspectj/aspectj/aspecjt1.8/doc/devguide/ajbrowser-building.gif)


### 浏览程序结构 ###

点击程序结构中的节点（见标签2）。 如果一个节点通过关联与一个或多个其他节点相关联，则该关联的名称将显示在该节点下方，并将以斜体显示。 与其他结构节点的链接在关联下以蓝色显示。 如果链接没有相应的来源，它将显示为浅蓝色。

![](file:///C:/Users/laihj/Desktop/myTool/about-aspectj/aspectj/aspecjt1.8/doc/devguide/ajbrowser-building.gif)

#### 示例：探索“Spacewar”示例代码 ####


- 启动浏览器

- 选择“文件 - >打开”或者点击“打开构建配置”按钮（），并选择用于调试spacewar示例的配置文件，例如/ spacewar / debug.lst。

- 点击“Build”按钮（）进行编译。 左窗格应该填充一个spacewar声明树。 如果存在编译器错误，则可以在标签4中显示可点击的错误消息。

注意：如果您没有设置类路径，编译将会失败，并显示一条消息，指出您需要在编译类路径中安装aspectjrt.jar。 要做到这一点，选择“工具 - >选项”或点击“选项”按钮（）。 单击Build Options选项卡查看Build Paths窗格。 编辑类路径条目以使用您的安装位置。 例如，如果您从基本的Aspectj目录运行，那么类路径只需包含lib / aspectjrt.jar（尽管浏览器可能最初使用bootclasspath和classpath填充类路径）。请确保使用传入的lib / aspectjrt.jar 与浏览器。



- 不同的结构视图：左侧的结构树可以显示结构的不同顺序和粒度：

	- 包层次结构视图显示了传统的包，类和成员的层次结构。

	- 继承视图显示了从最顶层父类到子成员的层次结构。

	- 横切视图显示了方面成员及其影响的代码。

	- 窗格中的其他按钮可用于更改粒度并过滤掉项目。

每当您在树视图中选择一个项目时，源窗格将滚动到该项目。如果您选择代表另一个程序元素的叶子项目，则树选择将转到相应的节点。 （请参阅下文了解如何使用两个窗格来维护您的位置。）

- 在处理方面时，它有助于在不同的程序元素之间导航：

	- 在查看方法时，请查找影响它的建议。

	- 查看切入点时，请查找使用它的建议。

	- 查看建议时，找到建议的内容 - 例如方法调用或执行，初始化器等。

	- 查看类型时，请查找声明该类型的成员或超类型的任何方面，反之亦然。

您可以使用默认的层次视图查看有关特定方法的建议。导航到debug.lst配置文件中spacewar.Registry.register（SpaceObject）的树项目。现在，在较低的文件视图中，您可以使用父级是受关系影响的方法的子树查看并导航到该建议。

您还可以使用横切视图来查看使用切入点或受建议影响的方法的建议。例如，要查看哪些建议使用特定的切入点，请导航到debug.lst配置文件中的切入点spacewar.Debug.allConstructorsCut（）的树项目。您可以使用关系使用的切入点查看并导航到使用切入点的建议。

作为看到受建议影响的方法的一个例子，在仍然处于同一视图中的情况下，请选择spacewar.Debug中的第一个前建议。它有两个使用切入点的关系子树并影响结构。影响关系将列出不同类型的连接点 - 构造函数或方法调用等。

请注意，AspectJ浏览器只能显示静态结构（无论是分层还是横切）。这意味着动态确定的切入点（如cflow（pointcut））不会显示为在源代码中挑选静态点。可显示的切入点大致对应于可以在声明错误语句中使用的切入点。


#### 运行项目 ####

浏览器支持有限形式的运行编译程序。 要运行已构建的程序，请单击`run`按钮或在`project`菜单中选择一个`run`菜单项。 你可以在同一个虚拟机上运行或产生一个新的进程; 后者通常对GUI程序更好。

两者都要求使用特定于平台的路径和路径分隔符来指定您设置的任何类路径（编译器可能会更宽容）。 输出和错误流将被合并到浏览器的流中（使用单独的线程，因此管道线程可能需要几秒钟才能获得控制权。）错误应该被检测到并显示在对话框中。

GUI不支持查杀正在运行的程序，所以如果你的程序可能挂起，一定要保存你的文件，因为你可能需要杀死浏览器来终止它的子进程。

----

### 隔离运行AspectJ浏览器的问题 ###

如果您的浏览器出现问题而未能通过文档解决，请尝试直接在命令行上运行ajc时是否遇到同样的问题。

- 如果问题也发生在命令行上，那么问题不在浏览器中。（它可能在编译器中;请发送错误报告。）

- 如果问题在命令行上没有发生，那么它可能在您正在构建选项中提供的参数中。

- 如果构建选项看起来正确，并且问题只发生在从浏览器构建时发生，那么请提交错误报告。

#### AspectJ浏览器的已知问题 ####

有关已知问题的最新信息，请参阅`bug database`以了解未解决的`compiler bugs` 或`IDE  bugs`。

- 内存和创建进程：用户通过电子邮件发送有关浏览器任务内存不足的邮件。 这不是浏览器的问题; 一些编译需要大量的内存，通常比使用javac的类似编译更多。 浏览器不支持创建进程，所以唯一的解决方法是编辑启动浏览器添加内存的java命令行或脚本。

- 编辑构建配置文件：目前不支持。

- 增量编译后结构模型不完整。 要获得完整的结构模型，需要完整的构建。

- 如果您更改输出目录，则必须完成全部构建。

#### 限制 ####

- AJBrowser期望包和目录结构匹配。 如果他们没有，它将无法浏览到相应的文件。

- "`Run`"功能在同一个虚拟机中启动应用程序。 因此，如果处理Swing应用程序，AJBrowser也将被处理。